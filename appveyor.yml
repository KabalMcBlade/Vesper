version: 1.0.{build}
image: Visual Studio 2022
platform: x64
environment:
  VULKAN_SDK_VERSION: '1.3.261.1'
  VULKAN_SDK: C:\VulkanSDK\$(VULKAN_SDK_VERSION)
  VK_SDK_PATH: C:\VulkanSDK\$(VULKAN_SDK_VERSION)

install:
- ps: >-
    $vulkanUrl = "https://vulkan.lunarg.com/sdk/download/$env:VULKAN_SDK_VERSION/windows/VulkanSDK-$env:VULKAN_SDK_VERSION-Installer.exe"
    $installerPath = "vulkan.exe"
    Invoke-WebRequest -Uri $vulkanUrl -OutFile $installerPath
    Start-Process -FilePath $installerPath -ArgumentList "/S" -NoNewWindow -Wait

    if (!(Test-Path "C:\tools\vcpkg")) {
      git clone https://github.com/microsoft/vcpkg.git C:\tools\vcpkg
      & C:\tools\vcpkg\bootstrap-vcpkg.bat
    } else {
      cd C:\tools\vcpkg
      git pull
      & C:\tools\vcpkg\bootstrap-vcpkg.bat
    }
    & C:\tools\vcpkg\vcpkg.exe integrate install
    & C:\tools\vcpkg\vcpkg.exe install glfw3 glm

build_script:
- ps: >-
    $solutionPath = "C:\projects\vesper\Vesper.sln"
    $msbuildArgs = "/p:Configuration=Release /p:Platform=x64"
    & "C:\Program Files\Microsoft Visual Studio\2022\BuildTools\MSBuild\Current\Bin\MSBuild.exe" $solutionPath $msbuildArgs
